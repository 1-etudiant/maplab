<?xml version="1.0"?>

<!--
Requires:
 - ethz-asl/maplab_private
 - ethz-asl/transfolder
-->


<launch>

	<!-- MAPLAB SERVER -->
	<group ns="maplab_server">
		<include file="$(find maplab_server_node)/launch/maplab-server-node.launch">
			<arg name="server_node_config_file" default="$(find maplab_server_node)/share/euroc/euroc-maplab-server-config-distributed.yaml"/>

			<arg name="v" default="0"/>

			<arg name="tf_map_frame" default="map"/>
			<arg name="tf_mission_frame" default="maplab_server_odom"/>
			<arg name="tf_imu_frame" default="maplab_server_imu"/>
		</include>

		<!-- TRANSFOLDER NODES -->
		<group if="true">
			<arg name="robot_name" value="euroc_mh_1"/>
			<node name="transfolder_receiver_$(arg robot_name)" pkg="transfolder" type="receiver_node" output="screen" args="-alsologtostderr">
				<remap from="/maplab_server/folder_ready" to="/transfolder/$(arg robot_name)/folder_arrival_notification" />
				<remap from="/maplab_server/file_transfer_status" to="/transfolder/$(arg robot_name)/file_transfer_status" />
				<remap from="/maplab_server/file_transfer" to="/transfolder/$(arg robot_name)/file_transfer" />

				<param name="root_directory" value="/tmp/maplab_server/"/>
			</node>
		</group>
		<group if="true">
			<arg name="robot_name" value="euroc_mh_2"/>
			<node name="transfolder_receiver_$(arg robot_name)" pkg="transfolder" type="receiver_node" output="screen" args="-alsologtostderr">
				<remap from="/maplab_server/folder_ready" to="/transfolder/$(arg robot_name)/folder_arrival_notification" />
				<remap from="/maplab_server/file_transfer_status" to="/transfolder/$(arg robot_name)/file_transfer_status" />
				<remap from="/maplab_server/file_transfer" to="/transfolder/$(arg robot_name)/file_transfer" />

				<param name="root_directory" value="/tmp/maplab_server/"/>
			</node>
		</group>
		<group if="true">
			<arg name="robot_name" value="euroc_mh_3"/>
			<node name="transfolder_receiver_$(arg robot_name)" pkg="transfolder" type="receiver_node" output="screen" args="-alsologtostderr">
				<remap from="/maplab_server/folder_ready" to="/transfolder/$(arg robot_name)/folder_arrival_notification" />
				<remap from="/maplab_server/file_transfer_status" to="/transfolder/$(arg robot_name)/file_transfer_status" />
				<remap from="/maplab_server/file_transfer" to="/transfolder/$(arg robot_name)/file_transfer" />

				<param name="root_directory" value="/tmp/maplab_server/"/>
			</node>
		</group>
		<group if="true">
			<arg name="robot_name" value="euroc_mh_4"/>
			<node name="transfolder_receiver_$(arg robot_name)" pkg="transfolder" type="receiver_node" output="screen" args="-alsologtostderr">
				<remap from="/maplab_server/folder_ready" to="/transfolder/$(arg robot_name)/folder_arrival_notification" />
				<remap from="/maplab_server/file_transfer_status" to="/transfolder/$(arg robot_name)/file_transfer_status" />
				<remap from="/maplab_server/file_transfer" to="/transfolder/$(arg robot_name)/file_transfer" />

				<param name="root_directory" value="/tmp/maplab_server/"/>
			</node>
		</group>
		<group if="true">
			<arg name="robot_name" value="euroc_mh_5"/>
			<node name="transfolder_receiver_$(arg robot_name)" pkg="transfolder" type="receiver_node" output="screen" args="-alsologtostderr">
				<remap from="/maplab_server/folder_ready" to="/transfolder/$(arg robot_name)/folder_arrival_notification" />
				<remap from="/maplab_server/file_transfer_status" to="/transfolder/$(arg robot_name)/file_transfer_status" />
				<remap from="/maplab_server/file_transfer" to="/transfolder/$(arg robot_name)/file_transfer" />

				<param name="root_directory" value="/tmp/maplab_server/"/>
			</node>
		</group>
	</group>

	<!-- ARTIFACT MANAGER NODE -->
	<group if="true">
		<include file="$(find artifact_manager_node)/launch/artifact-manager.launch">
			<arg name="artifact_store_file" default="$(find maplab_server_node)/share/euroc/dummy-artifact-store-euroc.txt" />
			<arg name="artifact_vis_world_frame_name" default="map" />
			<arg name="artifact_refinement_sensor_frame" default="NCAMERA" />
			<arg name="artifact_refinement_check_interval_s" default="10" />
			<arg name="artifact_ros_map_lookup_service_topic" default="/maplab_server/map_lookup"/>
			<arg name="artifact_ros_new_artifacts_sub_topic" default="/operator/confirmed_artifacts" />

			<arg name="artifact_ros_open_rqt" default="true" />
		</include>
	</group>

</launch>
